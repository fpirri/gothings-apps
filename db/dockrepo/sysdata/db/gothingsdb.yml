#                                                                                         2019-10-05
#
#  BASE part of GOTHINGS CLOUD
#
#  ===================================================================  COMMENTI SOTTO:  DA RIVEDERE
#
#  BASE in Fase 4 is made up from four containers:  nginx, base, redis & logspout
#
#  nginx     container implements a gateway from network to internal applications
#            it is a reverse proxy http server
#            it is differs only marginally from Fase 0 & 1
#            base image: gothings/nginx:arm-002
#            nginx version: openresty/1.13.6.1
#
#  base      is a nodejs container which runs two different http server 'counter'
#            it is a template to develop javascript applications using nodejs and redis
#            base image: gothings/vuedev:arm-001 <-- from gothings/nodebase:arm-004
#            node version is 10.16.0
#            npm version is 6.9.0
#            @vue/cli version 3.10.0
#
#  redis     container works as a basic name/value application storage for nodejs
#            Redis version 3.0.0 (32bit)
#
#  logspout  accept logs from other containers and send them to an UDP socket
#            a container may opt-out through an envireonment variable
#
#
###############
#
#    
###############

version: '3'

networks:
  gothingsnet:
    external: true
    # ipv4_addresses:
    #   172.29.196.180 : nginx
    #   172.29.196.181 : redis
    #   172.29.196.182 : logspout
    #   172.29.196.183 : nodesyslog
    #   172.29.196.184 : 
    #   172.29.196.185 : testvue
    #   172.29.196.186 : base
    #   172.29.196.187 : db
    #   172.29.196.188 : wp-fpm
    # 
  servicenet:
    external: true
    # ipv4_addresses:
    #   172.29.195.180 : nginx
    #   172.29.195.181 : redis
    #   172.29.195.182 : logspout
    #   172.29.195.183 : nodesyslog
    #   172.29.195.184 : mongo
    #   172.29.195.185 : testvue
    #   172.29.195.185 : base
    #   172.29.195.2   : nodesimple ??  autoassegnato da compose
    #
    ############
    #
    # NOTA:
    #        net host : vpn
    #

services:

  db:
    image: mysql:8.0
    container_name: db
    restart: unless-stopped
    env_file: .env-db
    environment:
      - MYSQL_DATABASE=gtlite
    volumes: 
      - ~/dockrepo/sysdata/dbdata:/var/lib/mysql
    command: '--default-authentication-plugin=mysql_native_password'
    networks: 
      gothingsnet:
        ipv4_address: 172.29.196.187
    ports:
      - "3306:3306"      # usata per 'services'

#  certbot:
#    #depends_on:
#    #  - webserver
#    image: certbot/certbot
#    container_name: certbot
#    volumes:
#      - ~/dockrepo/sysdata/nginxdata/certbot_etc:/etc/letsencrypt
#      - ~/dockrepo/sysdata/var_www/html/:/var/www/html
#    command: certonly --webroot --webroot-path=/var/www/html --email sammy@example.com --agree-tos --no-eff-email --force-renewal -d example.com -d www.example.com
  